Totalcases = matrix(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,
                      0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,4,0,0,0,0,0,0,0,0,
                      0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,11,0,0,0,0,4,0,0,0,
                      0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,19,0,0,0,0,6,0,0,0,
                      0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,2,1,0,0,26,0,0,0,0,10,0,0,0,
                      0,0,0,0,0,2,0,6,0,1,0,0,0,0,0,0,0,0,4,1,0,0,34,0,0,0,0,13,0,0,0,
                      2,0,0,0,0,2,1,8,0,1,1,0,0,0,0,0,0,0,4,3,0,0,50,1,0,0,0,22,0,0,0,
                      2,1,0,0,0,2,3,17,0,1,2,0,0,1,3,2,0,1,5,4,0,0,65,1,1,2,0,26,0,0,0, 
                      5,6,0,0,2,10,3,40,0,2,2,0,0,3,3,2,1,4,5,11,0,0,72,2,4,2,0,64,1,1,0,
                      8,7,0,0,6,20,3,65,2,2,2,0,0,3,6,2,3,4,5,20,0,2,88,2,6,2,0,128,1,1,0,
                      16,10,0,0,12,32,11,82,24,2,2,1,0,3,10,2,8,4,23,32,0,8,109,2,10,3,1,180,1,5,0,
                      47,10,0,0,12,45,19,110,24,5,4,2,2,5,19,2,8,12,67,43,0,8,139,19,13,4,3,350,1,5,0,
                      57,10,0,0,12,68,27,163,24,5,11,4,4,6,31,2,8,12,85,55,0,26,201,26,13,5,5,575,5,6,0,
                      93,12,0,0,46,120,35,218,24,10,11,4,4,7,35,2,8,14,141,62,0,55,253,29,30,6,5,1043,5,7,2,
                      112,12,0,1,55,120,49,253,33,10,11,11,18,22,62,2,12,19,149,71,1,80,354,37,38,14,5,1296,5,7,8,
                      173,26,3,9,65,238,68,333,37,16,13,11,18,22,63,2,18,30,180,121,3,111,386,89,60,19,15,1352,10,7,15,
                      302,40,5,14,75,388,81,424,104,23,19,13,25,27,63,6,42,80,228,301,15,176,523,89,114,21,18,1413,11,57,50,
                      305,41,8,16,77,484,95,494,162,34,30,15,40,31,64,6,44,107,265,606,23,178,668,135,138,34,18,1539,33,81,52
),nrow = 31, ncol = 18)

state = c("Alborz", "Ardebil", "Bushehr", "Chahar Mahall and Bakhtiari", "East Azarbaijan",
          "Esfahan", "Fars", "Gilan", "Golestan", "Hamadan", "Hormozgan", "Ilam", "Kerman", 
          "Kermanshah", "Khuzestan", "Kohgiluyeh and Buyer Ahmad", "Kordestan", "Lorestan",
          "Markazi", "Mazandaran", "North Khorasan", "Qazvin", "Qom", "Razavi Khorasan",
          "Semnan", "Sistan and Baluchestan", "South Khorasan", "Tehran", "West Azarbaijan", 
          "Yazd", "Zanjan")
rownames(Totalcases) = state
colnames(Totalcases) = c("190220", "200220", "210220", "220220", "230220", "240220",
                         "250220", "260220", "270220", "280220", "290220", "010320", 
                         "020320", "030320", "040320", "050320", "060320", "070320")
population = c(2712400, 1270420, 1163400, 947763,3909652,5120850,4851274,2530696,1868619,1758268,
               1776415,580158,3164718,1952434,4710509,713052,1603011,1760649,1429475,3283582,
               863092,1273761,1292283,6434501,702360,2775014,768898,13267637,3265219,1138533,1057461)
########################################################
#                    DATES
########################################################
START.IR = as.Date("19/02/20", "%d/%m/%y")

END.IR = as.Date("07/03/20", "%d/%m/%y")

(cronaDates.IR <- seq(START.IR, END.IR, by="1 day"))

Rate = rowSums(Totalcases)/population * 10000

MatRate = round((Totalcases)/population * 100000, 3)
colnames(MatRate) = as.character(cronaDates.IR)
oo = Rate[Rate>5]
ts.plot(t(Totalcases[oo,])/Rate, col = 1:10)

########################################################
#                    GGplot
########################################################
library(ggplot2)
# Basic barplot
p<-ggplot(data = data.frame(Rate, state), aes(x= state, y = Rate )) +
  geom_bar(stat="identity", fill = heat.colors(31)) +
  geom_text(aes(label= round(Rate,2)), vjust=1.6, color="gray30", size=3.5)+
  theme_minimal()
plot(p)

########################################################
#                    Animation by
########################################################


dataR = data.frame(Rate, state)
for(i in 1: dim(MatRate)[2]) {
  oo = MatRate[,i]#[MatRate[,i]>0]
  if(length(oo)>10)  oo = sort(oo, T)[1:10]
  Namestat = names(oo)
  p<-ggplot(data = data.frame(oo, state = Namestat), aes(x= state, y = oo )) +
    geom_bar(stat = "identity", fill = heat.colors(10)) +
    geom_text(aes(label= round(oo,2)), vjust=1.6, color="gray30", size=3.5)+
    theme_minimal()
  plot(p)
  Sys.sleep(1)
}

########################################################
#                    Animation  Barplot
########################################################

for(i in 1: dim(MatRate)[2]) {
  oo = MatRate[,i]#[MatRate[,i]>0]
  if(length(oo)>10)  oo = sort(oo, T)[1:10]
  barplot(sort(oo, T), col = heat.colors(length(oo)),
          main = paste('Rate by Population on   ', cronaDates.IR[i]))
  Sys.sleep(2)
}